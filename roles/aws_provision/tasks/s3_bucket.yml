---
- name: Administration of S3 Buckets
  amazon.aws.s3_bucket:
    name: "{{ item.name }}"
    acl: "{{ item.acl }}"
    delete_public_access: "{{ item.delete_public_access | default(omit) }}"
    region: "{{ aws_provision_region }}"
    state: "{{ item.state }}"
    tags: "{{ item.tags }}"
    versioning: "{{ item.versioning }}"
  loop: "{{ aws_provision_s3_buckets }}"
  when: aws_provision_s3_buckets is defined and \
        aws_provision_s3_buckets | length > 0

- name: Lifecycle Policy f√ºr S3-Bucket setzen
  community.aws.s3_lifecycle:
    name: "{{ item.name }}"
    region: "{{ aws_provision_region }}"
    state: present
    status: enabled
    rule_id: "delete-after-{{ item.lifecycle_days }}-days"
    prefix: ""
    expiration_days: "{{ item.lifecycle_days }}"
  loop: "{{ aws_provision_s3_buckets }}"
  when: item.lifecycle_days is defined
